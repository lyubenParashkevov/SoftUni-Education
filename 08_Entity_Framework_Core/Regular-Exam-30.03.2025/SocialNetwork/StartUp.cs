using Microsoft.EntityFrameworkCore;
using SocialNetwork.Data;

namespace SocialNetwork
{
    public class StartUp
    {
        static void Main(string[] args)
        {
            //string expectedOutput = "[\r\n  {\r\n    \"Id\": 6,\r\n    \"Title\": \"Study Group\",\r\n    \"StartedAt\": \"2024-08-10T14:00:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey ladies, let's focus on the upcoming exam topics.\",\r\n        \"SentAt\": \"2024-08-10T14:05:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes! I was reviewing the lecture on algorithms, it’s tricky.\",\r\n        \"SentAt\": \"2024-08-10T14:10:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Let’s break it down together. What part is confusing?\",\r\n        \"SentAt\": \"2024-08-10T14:15:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"I struggle with recursion. The call stack gets confusing.\",\r\n        \"SentAt\": \"2024-08-10T14:20:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"I can explain! Think of it like a nested to-do list.\",\r\n        \"SentAt\": \"2024-08-10T14:25:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"That makes sense! Let’s go over an example step by step.\",\r\n        \"SentAt\": \"2024-08-10T14:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Also, let’s make flashcards for key concepts.\",\r\n        \"SentAt\": \"2024-08-10T14:35:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Good idea! I’ll prepare some on data structures.\",\r\n        \"SentAt\": \"2024-08-10T14:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Awesome! Let’s quiz each other in an hour.\",\r\n        \"SentAt\": \"2024-08-10T14:45:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 5,\r\n    \"Title\": \"BackUp Group\",\r\n    \"StartedAt\": \"2024-08-10T20:11:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Alright, Secret Society is back in session!\",\r\n        \"SentAt\": \"2024-08-10T20:12:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Haha, finally! What’s the topic of the day?\",\r\n        \"SentAt\": \"2024-08-10T20:14:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"Hey guys, should we meet up this weekend?\",\r\n        \"SentAt\": \"2024-08-10T20:15:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"How about crazy work stories? I have a good one.\",\r\n        \"SentAt\": \"2024-08-10T20:16:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"Oh no... do tell!\",\r\n        \"SentAt\": \"2024-08-10T20:18:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"So, our manager accidentally sent an email to the whole company...\",\r\n        \"SentAt\": \"2024-08-10T20:20:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"Oh boy. What did it say?\",\r\n        \"SentAt\": \"2024-08-10T20:22:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"Something about 'the disaster report'... but it was meant for just HR.\",\r\n        \"SentAt\": \"2024-08-10T20:25:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"LMAO! That’s gold.\",\r\n        \"SentAt\": \"2024-08-10T20:28:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"I swear, working in this place is pure entertainment.\",\r\n        \"SentAt\": \"2024-08-10T20:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"That’s why we have this group. Secret Society forever!\",\r\n        \"SentAt\": \"2024-08-10T20:33:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 4,\r\n    \"Title\": \"Movie Night\",\r\n    \"StartedAt\": \"2025-01-31T16:23:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey love, let's plan a movie night this weekend!\",\r\n        \"SentAt\": \"2025-01-31T16:23:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"That sounds great! What movie do you have in mind?\",\r\n        \"SentAt\": \"2025-01-31T16:28:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Maybe something romantic, or a good thriller?\",\r\n        \"SentAt\": \"2025-01-31T16:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Ooooh, a thriller sounds fun! Let’s do that!\",\r\n        \"SentAt\": \"2025-01-31T16:35:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Perfect! We should leave the kids with my parents.\",\r\n        \"SentAt\": \"2025-01-31T16:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes, I’ll call them now to ask if they’re free.\",\r\n        \"SentAt\": \"2025-01-31T16:42:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Hey, did you book the tickets for the movie?\",\r\n        \"SentAt\": \"2025-01-31T16:45:00\",\r\n        \"Status\": 3,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"They said yes! They’ll take care of the kids.\",\r\n        \"SentAt\": \"2025-01-31T16:50:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Awesome! I’ll book the tickets. Popcorn and soda?\",\r\n        \"SentAt\": \"2025-01-31T16:55:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes please! Can’t wait for our date night!\",\r\n        \"SentAt\": \"2025-01-31T17:00:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 2,\r\n    \"Title\": \"Weekend Plans\",\r\n    \"StartedAt\": \"2025-02-22T18:00:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey, any plans for the weekend?\",\r\n        \"SentAt\": \"2025-02-22T18:00:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"How about a trip to the mountains?\",\r\n        \"SentAt\": \"2025-02-22T18:05:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"That sounds like a great idea! Who else is in?\",\r\n        \"SentAt\": \"2025-02-22T18:10:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"I’m definitely in! We should decide on the exact place.\",\r\n        \"SentAt\": \"2025-02-22T18:15:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Maybe we can go to Green Valley? It’s a great hiking spot.\",\r\n        \"SentAt\": \"2025-02-22T18:20:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Sounds perfect! Let’s meet on Saturday morning.\",\r\n        \"SentAt\": \"2025-02-22T18:25:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Okay, I’ll bring some snacks and drinks.\",\r\n        \"SentAt\": \"2025-02-22T18:30:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"And I’ll bring the music!\",\r\n        \"SentAt\": \"2025-02-22T18:35:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 3,\r\n    \"Title\": \"Team Meeting\",\r\n    \"StartedAt\": \"2025-02-23T10:15:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Good morning, everyone! Let's start the team meeting.\",\r\n        \"SentAt\": \"2025-02-23T10:20:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Morning! What's the agenda for today?\",\r\n        \"SentAt\": \"2025-02-23T10:20:25\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"We'll go over project updates and deadlines.\",\r\n        \"SentAt\": \"2025-02-23T10:21:30\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"I've made progress on the front-end implementation.\",\r\n        \"SentAt\": \"2025-02-23T10:22:10\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Great! How about the backend integration?\",\r\n        \"SentAt\": \"2025-02-23T10:22:40\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"We’ve completed 70% of the API endpoints.\",\r\n        \"SentAt\": \"2025-02-23T10:23:05\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"That’s great! Let's set a deadline for testing.\",\r\n        \"SentAt\": \"2025-02-23T10:25:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Agreed! We should have a working version by next week.\",\r\n        \"SentAt\": \"2025-02-23T10:25:20\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"david_jackson\"\r\n      },\r\n      {\r\n        \"Content\": \"Let’s keep the momentum going!\",\r\n        \"SentAt\": \"2025-02-23T10:25:30\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Alright, let's wrap up and document today’s points.\",\r\n        \"SentAt\": \"2025-02-23T10:26:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 1,\r\n    \"Title\": \"Project Discussion\",\r\n    \"StartedAt\": \"2025-02-24T14:30:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey everyone, let's finalize the project scope.\",\r\n        \"SentAt\": \"2025-02-24T14:30:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"I think we should focus on the core functionalities first.\",\r\n        \"SentAt\": \"2025-02-24T14:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Agreed! We can add extra features later.\",\r\n        \"SentAt\": \"2025-02-24T14:45:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Let's divide tasks accordingly. Who wants to handle what?\",\r\n        \"SentAt\": \"2025-02-24T14:50:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"david_jackson\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll work on the database design.\",\r\n        \"SentAt\": \"2025-02-24T14:55:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll handle the API development.\",\r\n        \"SentAt\": \"2025-02-24T15:00:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll take care of the front-end part.\",\r\n        \"SentAt\": \"2025-02-24T15:05:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Great! Let's keep each other updated.\",\r\n        \"SentAt\": \"2025-02-24T15:10:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      }\r\n    ]\r\n  }\r\n]";
            //string actualOutput = "[\r\n  {\r\n    \"Id\": 6,\r\n    \"Title\": \"Study Group\",\r\n    \"StartedAt\": \"2024-08-10T14:00:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey ladies, let's focus on the upcoming exam topics.\",\r\n        \"SentAt\": \"2024-08-10T14:05:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes! I was reviewing the lecture on algorithms, it’s tricky.\",\r\n        \"SentAt\": \"2024-08-10T14:10:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Let’s break it down together. What part is confusing?\",\r\n        \"SentAt\": \"2024-08-10T14:15:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"I struggle with recursion. The call stack gets confusing.\",\r\n        \"SentAt\": \"2024-08-10T14:20:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"I can explain! Think of it like a nested to-do list.\",\r\n        \"SentAt\": \"2024-08-10T14:25:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"That makes sense! Let’s go over an example step by step.\",\r\n        \"SentAt\": \"2024-08-10T14:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Also, let’s make flashcards for key concepts.\",\r\n        \"SentAt\": \"2024-08-10T14:35:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Good idea! I’ll prepare some on data structures.\",\r\n        \"SentAt\": \"2024-08-10T14:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Awesome! Let’s quiz each other in an hour.\",\r\n        \"SentAt\": \"2024-08-10T14:45:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 5,\r\n    \"Title\": \"BackUp Group\",\r\n    \"StartedAt\": \"2024-08-10T20:11:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Alright, Secret Society is back in session!\",\r\n        \"SentAt\": \"2024-08-10T20:12:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"Haha, finally! What’s the topic of the day?\",\r\n        \"SentAt\": \"2024-08-10T20:14:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"Hey guys, should we meet up this weekend?\",\r\n        \"SentAt\": \"2024-08-10T20:15:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"How about crazy work stories? I have a good one.\",\r\n        \"SentAt\": \"2024-08-10T20:16:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"Oh no... do tell!\",\r\n        \"SentAt\": \"2024-08-10T20:18:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"So, our manager accidentally sent an email to the whole company...\",\r\n        \"SentAt\": \"2024-08-10T20:20:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"Oh boy. What did it say?\",\r\n        \"SentAt\": \"2024-08-10T20:22:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"Something about 'the disaster report'... but it was meant for just HR.\",\r\n        \"SentAt\": \"2024-08-10T20:25:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"LMAO! That’s gold.\",\r\n        \"SentAt\": \"2024-08-10T20:28:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"I swear, working in this place is pure entertainment.\",\r\n        \"SentAt\": \"2024-08-10T20:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"That’s why we have this group. Secret Society forever!\",\r\n        \"SentAt\": \"2024-08-10T20:33:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 4,\r\n    \"Title\": \"Movie Night\",\r\n    \"StartedAt\": \"2025-01-31T16:23:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey love, let's plan a movie night this weekend!\",\r\n        \"SentAt\": \"2025-01-31T16:23:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"That sounds great! What movie do you have in mind?\",\r\n        \"SentAt\": \"2025-01-31T16:28:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Maybe something romantic, or a good thriller?\",\r\n        \"SentAt\": \"2025-01-31T16:30:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Ooooh, a thriller sounds fun! Let’s do that!\",\r\n        \"SentAt\": \"2025-01-31T16:35:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Perfect! We should leave the kids with my parents.\",\r\n        \"SentAt\": \"2025-01-31T16:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes, I’ll call them now to ask if they’re free.\",\r\n        \"SentAt\": \"2025-01-31T16:42:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Hey, did you book the tickets for the movie?\",\r\n        \"SentAt\": \"2025-01-31T16:45:00\",\r\n        \"Status\": 3,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"They said yes! They’ll take care of the kids.\",\r\n        \"SentAt\": \"2025-01-31T16:50:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Awesome! I’ll book the tickets. Popcorn and soda?\",\r\n        \"SentAt\": \"2025-01-31T16:55:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Yes please! Can’t wait for our date night!\",\r\n        \"SentAt\": \"2025-01-31T17:00:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 2,\r\n    \"Title\": \"Weekend Plans\",\r\n    \"StartedAt\": \"2025-02-22T18:00:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey, any plans for the weekend?\",\r\n        \"SentAt\": \"2025-02-22T18:00:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"How about a trip to the mountains?\",\r\n        \"SentAt\": \"2025-02-22T18:05:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"That sounds like a great idea! Who else is in?\",\r\n        \"SentAt\": \"2025-02-22T18:10:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"I’m definitely in! We should decide on the exact place.\",\r\n        \"SentAt\": \"2025-02-22T18:15:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Maybe we can go to Green Valley? It’s a great hiking spot.\",\r\n        \"SentAt\": \"2025-02-22T18:20:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Sounds perfect! Let’s meet on Saturday morning.\",\r\n        \"SentAt\": \"2025-02-22T18:25:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Okay, I’ll bring some snacks and drinks.\",\r\n        \"SentAt\": \"2025-02-22T18:30:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"And I’ll bring the music!\",\r\n        \"SentAt\": \"2025-02-22T18:35:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 3,\r\n    \"Title\": \"Team Meeting\",\r\n    \"StartedAt\": \"2025-02-23T10:15:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Good morning, everyone! Let's start the team meeting.\",\r\n        \"SentAt\": \"2025-02-23T10:20:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Morning! What's the agenda for today?\",\r\n        \"SentAt\": \"2025-02-23T10:20:25\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"We'll go over project updates and deadlines.\",\r\n        \"SentAt\": \"2025-02-23T10:21:30\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"I've made progress on the front-end implementation.\",\r\n        \"SentAt\": \"2025-02-23T10:22:10\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Great! How about the backend integration?\",\r\n        \"SentAt\": \"2025-02-23T10:22:40\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"sara_miller\"\r\n      },\r\n      {\r\n        \"Content\": \"We’ve completed 70% of the API endpoints.\",\r\n        \"SentAt\": \"2025-02-23T10:23:05\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"michael_brown\"\r\n      },\r\n      {\r\n        \"Content\": \"That’s great! Let's set a deadline for testing.\",\r\n        \"SentAt\": \"2025-02-23T10:25:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"emily_white\"\r\n      },\r\n      {\r\n        \"Content\": \"Agreed! We should have a working version by next week.\",\r\n        \"SentAt\": \"2025-02-23T10:25:20\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"david_jackson\"\r\n      },\r\n      {\r\n        \"Content\": \"Let’s keep the momentum going!\",\r\n        \"SentAt\": \"2025-02-23T10:25:30\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"olivia_taylor\"\r\n      },\r\n      {\r\n        \"Content\": \"Alright, let's wrap up and document today’s points.\",\r\n        \"SentAt\": \"2025-02-23T10:26:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"william_clark\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"Id\": 1,\r\n    \"Title\": \"Project Discussion\",\r\n    \"StartedAt\": \"2025-02-24T14:30:00\",\r\n    \"Messages\": [\r\n      {\r\n        \"Content\": \"Hey everyone, let's finalize the project scope.\",\r\n        \"SentAt\": \"2025-02-24T14:30:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"I think we should focus on the core functionalities first.\",\r\n        \"SentAt\": \"2025-02-24T14:40:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Agreed! We can add extra features later.\",\r\n        \"SentAt\": \"2025-02-24T14:45:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"john_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Let's divide tasks accordingly. Who wants to handle what?\",\r\n        \"SentAt\": \"2025-02-24T14:50:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"david_jackson\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll work on the database design.\",\r\n        \"SentAt\": \"2025-02-24T14:55:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"william_clark\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll handle the API development.\",\r\n        \"SentAt\": \"2025-02-24T15:00:00\",\r\n        \"Status\": 2,\r\n        \"SenderUsername\": \"alex_smith\"\r\n      },\r\n      {\r\n        \"Content\": \"I'll take care of the front-end part.\",\r\n        \"SentAt\": \"2025-02-24T15:05:00\",\r\n        \"Status\": 0,\r\n        \"SenderUsername\": \"jane_doe\"\r\n      },\r\n      {\r\n        \"Content\": \"Great! Let's keep each other updated.\",\r\n        \"SentAt\": \"2025-02-24T15:10:00\",\r\n        \"Status\": 1,\r\n        \"SenderUsername\": \"john_doe\"\r\n      }\r\n    ]\r\n  }\r\n]";
            
           
            //Console.WriteLine($"Expected: '{expectedOutput[328]}'");
            //Console.WriteLine($"Actual: '{actualOutput[328]}'");




            SocialNetworkDbContext dbContext = new SocialNetworkDbContext();

            ResetDatabase(dbContext, shouldDropDatabase: true);

            var projectDir = GetProjectDirectory();

            ImportEntities(dbContext, projectDir + @"Datasets/", projectDir + @"ImportResults/");
            ExportEntities(dbContext, projectDir + @"ExportResults/");

            using (var transaction = dbContext.Database.BeginTransaction())
            {
                transaction.Rollback();
            }
        }

        private static void ImportEntities(SocialNetworkDbContext dbContext, string baseDir, string exportDir)
        {
            var messages = DataProcessor.Deserializer
                .ImportMessages(dbContext, File.ReadAllText(baseDir + "messages.xml"));

            PrintAndExportEntityToFile(messages, exportDir + "ActualResult_ImportMessages.txt");

            var posts = DataProcessor.Deserializer
                .ImportPosts(dbContext, File.ReadAllText(baseDir + "posts.json"));

            PrintAndExportEntityToFile(posts, exportDir + "ActualResult_ImportPosts.txt");
        }

        private static void ExportEntities(SocialNetworkDbContext dbContext, string exportDir)
        {
            var UsersWithTheirPosts = DataProcessor.Serializer
                .ExportUsersWithFriendShipsCountAndTheirPosts(dbContext);

            Console.WriteLine(UsersWithTheirPosts);
            File.WriteAllText(exportDir + "ActualResult_ExportUsersWithTheirPosts.xml", UsersWithTheirPosts);

            var Conversations = DataProcessor.Serializer
                .ExportConversationsWithMessagesChronologically(dbContext);

            Console.WriteLine(Conversations);
            File.WriteAllText(exportDir + "ActualResult_ExportConversationsWithMessages.json", Conversations);
        }

        private static void PrintAndExportEntityToFile(string entityOutput, string outputPath)
        {
            Console.WriteLine(entityOutput);
            File.WriteAllText(outputPath, entityOutput.TrimEnd());
        }

        private static object GetProjectDirectory()
        {
            var directory = Directory.GetCurrentDirectory();
            var directoryName = Path.GetFileName(directory);
            var relativePath  = directoryName.StartsWith("net6.0") ? @"../../../" : string.Empty;

            return relativePath;
        }

        private static void ResetDatabase(SocialNetworkDbContext dbContext, bool shouldDropDatabase = false)
        {
            if (shouldDropDatabase)
            {
                dbContext.Database.EnsureDeleted();
                dbContext.Database.EnsureCreated();
            }
            else
            {
                if (dbContext.Database.EnsureCreated())
                {
                    return;
                }

                string disableIntegrityChecksQuery = "EXEC sp_MSforeachtable @command1='ALTER TABLE ? NOCHECK CONSTRAINT ALL'";
                dbContext.Database.ExecuteSqlRaw(disableIntegrityChecksQuery);

                string deleteRowsQuery = "EXEC sp_MSforeachtable @command1='SET QUOTED_IDENTIFIER ON;DELETE FROM ?'";
                dbContext.Database.ExecuteSqlRaw(deleteRowsQuery);

                string enableIntegrityChecksQuery = "EXEC sp_MSforeachtable @command1='ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL'";
                dbContext.Database.ExecuteSqlRaw(enableIntegrityChecksQuery);

                string reseedQuery = "EXEC sp_MSforeachtable @command1='IF OBJECT_ID(''?'') IN (SELECT OBJECT_ID FROM SYS.IDENTITY_COLUMNS) DBCC CHECKIDENT(''?'', RESEED, 0)'";
                dbContext.Database.ExecuteSqlRaw(reseedQuery);
            }
        }
    }
}
